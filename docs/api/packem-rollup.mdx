---
title: @visulima/packem-rollup
description: API documentation for Packem Rollup plugins and transformers
---

# @visulima/packem-rollup

Rollup plugins and transformer integrations for Packem.

## Installation

```bash
npm install @visulima/packem-rollup
```

## Transformers

### esbuild Transformer

```typescript
import transformer from '@visulima/packem-rollup/transformer/esbuild'
```

Fast JavaScript/TypeScript transformer using esbuild.

### swc Transformer

```typescript
import transformer from '@visulima/packem-rollup/transformer/swc'
```

Rust-powered transformer using swc.

### OXC Transformer

```typescript
import transformer from '@visulima/packem-rollup/transformer/oxc'
```

Next-generation JavaScript toolchain.

### sucrase Transformer

```typescript
import transformer from '@visulima/packem-rollup/transformer/sucrase'
```

Lightweight JavaScript transformer.

### TypeScript Transformer

```typescript
import transformer from '@visulima/packem-rollup/transformer/typescript'
```

Official TypeScript compiler transformer.

## Plugins

### nativeModulesPlugin

```typescript
import { nativeModulesPlugin } from '@visulima/packem-rollup'
```

Handles native Node.js addons (.node files) by copying them to the output directory and generating appropriate import statements.

#### Usage

```typescript
import { defineConfig } from '@visulima/packem/config'
import transformer from '@visulima/packem/transformer/esbuild'

export default defineConfig({
  transformer,
  rollup: {
    nativeModules: {
      nativesDirectory: 'natives'
    }
  }
})
```

#### Options

```typescript
interface NativeModulesOptions {
  /**
   * Custom subdirectory name for native modules within the output directory
   * @default 'natives'
   */
  nativesDirectory?: string
}
```

See [native-modules-plugin API docs](/docs/api/native-modules-plugin) for detailed documentation.

### require-cjs-transformer

```typescript
import { requireCJSTransformerPlugin } from '@visulima/packem-rollup'
```

Transform ESM imports of CJS packages to `require()` calls for better performance.

#### Usage

```typescript
import { defineConfig } from '@visulima/packem/config'
import transformer from '@visulima/packem/transformer/esbuild'
import { requireCJSTransformerPlugin } from '@visulima/packem-rollup'

export default defineConfig({
  transformer,
  rollup: {
    plugins: [
      requireCJSTransformerPlugin({
        builtinNodeModules: true
      })
    ]
  }
})
```

#### Options

```typescript
interface RequireCJSPluginOptions {
  builtinNodeModules?: boolean
  cwd?: string
  additionalPackages?: string[]
  exclude?: string[]
  include?: string[]
  excludePatterns?: string[]
}
```

See [require-cjs-transformer API docs](/docs/api/require-cjs-transformer) for detailed documentation.

### minify-html-literals

```typescript
import { minifyHTMLLiteralsPlugin } from '@visulima/packem-rollup'
```

Automatically minifies HTML and CSS content within template literals during the build process. This plugin identifies tagged template literals containing HTML/CSS and applies minification to reduce bundle size.

:::note
This plugin only runs when minification is enabled in Packem (`minify: true` in your configuration).
:::

#### Usage

```typescript
import { defineConfig } from '@visulima/packem/config'
import transformer from '@visulima/packem/transformer/esbuild'

export default defineConfig({
  transformer,
  minify: true, // Required for the plugin to run
  rollup: {
    minifyHTMLLiterals: {
      include: ['**/*.ts', '**/*.js'],
      failOnError: false
    }
  }
})
```

#### Options

```typescript
interface MinifyHTMLLiteralsOptions {
  /**
   * Pattern or array of patterns of files not to minify.
   */
  exclude?: FilterPattern;

  /**
   * If true, any errors while parsing or minifying will abort the bundle
   * process. Defaults to false, which will only show a warning.
   */
  failOnError?: boolean;

  /**
   * Pattern or array of patterns of files to minify.
   */
  include?: string | string[];

  /**
   * Override minify-html-literals function.
   */
  minifyHTMLLiterals?: typeof minifyHTMLLiterals;

  /**
   * Minify options, see
   * https://www.npmjs.com/package/minify-html-literals#options.
   */
  options?: Partial<MinifyHTMLLiteralsOptions>;
}
```

### Other Rollup Plugins

Packem includes several other Rollup plugins:

- **CSS Processing**: Sass, Less, Stylus, PostCSS support
- **Asset Handling**: Image and font processing
- **TypeScript**: Declaration file generation
- **Optimization**: Minification and tree shaking

## Utilities

### isPureCJS

```typescript
import { isPureCJS } from '@visulima/packem-rollup'

const result = await isPureCJS('typescript', '/path/to/importer')
console.log(result) // true
```

Detects if a package is CommonJS-only.

#### Parameters

- **id** (`string`): Package name or path
- **importer** (`string`): Importing file path
- **rollupResolve** (`Function?`): Custom resolver function

#### Returns

`Promise<boolean>` - True if the package is CJS-only.

## Types

### PackemRollupOptions

```typescript
interface PackemRollupOptions {
  css?: CssOptions
  minifyHTMLLiterals?: MinifyHTMLLiteralsOptions | false
  nativeModules?: NativeModulesOptions | false
  requireCJS?: RequireCJSPluginOptions | false
  plugins?: Plugin[]
  // ... other Rollup options
}
```

Configuration options for Rollup in Packem.

### NativeModulesOptions

```typescript
interface NativeModulesOptions {
  /**
   * Custom subdirectory name for native modules within the output directory
   * @default 'natives'
   */
  nativesDirectory?: string
}
```

Configuration options for the native modules plugin.

### RequireCJSPluginOptions

See [require-cjs-transformer API docs](/docs/api/require-cjs-transformer#requirecjspluginoptions).

## Examples

### Basic Transformer Usage

```typescript
import { defineConfig } from '@visulima/packem/config'
import esbuildTransformer from '@visulima/packem-rollup/transformer/esbuild'

export default defineConfig({
  transformer: esbuildTransformer,
  rollup: {
    requireCJS: {
      builtinNodeModules: true
    }
  }
})
```

### Advanced Plugin Configuration

```typescript
import { defineConfig } from '@visulima/packem/config'
import transformer from '@visulima/packem-rollup/transformer/swc'
import { requireCJSTransformerPlugin } from '@visulima/packem-rollup'

export default defineConfig({
  transformer,
  minify: true, // Required for minify-html-literals to run
  rollup: {
    minifyHTMLLiterals: {
      include: ['src/**/*.ts'],
      options: {
        minifyOptions: {
          collapseWhitespace: true,
          removeComments: true
        }
      }
    },
    plugins: [
      requireCJSTransformerPlugin({
        builtinNodeModules: true,
        additionalPackages: ['my-cjs-lib']
      })
    ]
  }
})
```

## Related

- [Packem Configuration](/docs/guide/configuration)
- [Transformers Guide](/docs/guide/transformers)
- [require-cjs-transformer Plugin](/docs/guide/require-cjs-transformer)
- [require-cjs-transformer Examples](/docs/examples/advanced/require-cjs-transformer)
